#!/bin/bash
##############################################################################
# avconv
# -----------
# convert avi or mkv files to mp4
#
# Usage:
# 	avconvert [directory] [permissions]
#
# :authors: Adrian Herrera, @simplyadrian
# :date: 18 March 2018
# :version: 0.0.1
##############################################################################

# Print a usage message and exit.
display_usage() {
	echo "This script must be run with arguments."
	echo -e "\nUsage:\navconvert [directory] [extension] \n"
	echo -e "Arguments:\nDirectory == The directory you want to iterate over.\n"
	echo -e "\nExtension == The file format you want to operate on.\n"
	echo -e "Example:\n ./avconvert /mnt/tvshows/ *.mkv"
}

# if less than two arguments supplied, display usage
if [  $# -le 0 ]
then
	display_usage
	exit 1
fi

# check whether user had supplied -h or --help . If yes display usage
if [[ ( $# == "--help") ||  $# == "-h" ]]
then
	display_usage
	exit 0
fi

for i in $(find $1 -type f -name '*.avi' -print0 | xargs -0 -n 1);
do
    avconv -y -i "$i" -vcodec libx264 -acodec aac -strict experimental -threads 3 "${i%.*}.mp4";
    rm "$i";
    chmod 664 "${i%.*}.mp4";
done

for i in $(find $1 -type f -name '*.mkv' -print0 | xargs -0 -n 1);
do
    avconv -y -i "$i" -vcodec libx264 -acodec aac -strict experimental -threads 3 "${i%.*}.mp4";
    rm "$i";
    chmod 664 "${i%.*}.mp4";
done
